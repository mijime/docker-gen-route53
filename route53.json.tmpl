{
"Changes": [
{{ $data := groupByMulti $ "Env.VIRTUAL_HOST" "," }}
{{ range $host, $containers := $data }}
{{ range $container := $containers }}
{{ if(ne (index $data 0 0) $host)  }},{{ end }}
    {
        "Action": "UPSERT",
        "ResourceRecordSet": {
        "Name": "{{$host}}",
        "Type": "CNAME",
        "TTL": 300,
        "ResourceRecords": [
        {
        "Value": "{{$.Env.SELF_HOST}}"
        }
        ]
        }
    }
{{ end }}
{{ end }}
]
}
